<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="android-chrome-512x512.png" type="image/x-icon">
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JY20JB7P0D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-JY20JB7P0D');
</script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Length Converter | Convert Meters, Feet, Inches, Miles & More</title>
  <meta name="description" content="Free online length converter. Convert between meters, centimeters, millimeters, kilometers, feet, inches, yards, miles and more with precision. Real-time conversions with history tracking.">
  <meta name="keywords" content="length converter, meters to feet, feet to meters, inches to cm, length calculator, distance conversion">
  <meta name="author" content="Length Converter">
  
  <!-- Open Graph / Social Media Meta Tags -->
  <meta property="og:title" content="Length Converter | Convert Meters, Feet, Inches, Miles & More">
  <meta property="og:description" content="Free online length converter. Convert between meters, centimeters, millimeters, kilometers, feet, inches, yards, miles and more with precision.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://example.com/length-converter-preview.png">
  
  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Length Converter | Convert Meters, Feet, Inches, Miles & More">
  <meta name="twitter:description" content="Free online length converter. Convert between meters, centimeters, millimeters, kilometers, feet, inches, yards, miles and more with precision.">
  
  <!-- JSON-LD Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Length Converter",
    "description": "Free online length converter that converts between meters, centimeters, millimeters, kilometers, feet, inches, yards, miles and more with precision control.",
    "url": "https://example.com/length-converter",
    "applicationCategory": "UtilityApplication",
    "operatingSystem": "Any",
    "permissions": "browser",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "author": {
      "@type": "Organization",
      "name": "Length Converter"
    },
    "featureList": [
      "Real-time length conversion",
      "Multiple length units (meters, centimeters, millimeters, kilometers, feet, inches, yards, miles)",
      "Adjustable precision",
      "Conversion history",
      "Export results as CSV/JSON"
    ]
  }
  </script>
  
  <style>
    :root {
      --primary-color: #008080;
      --primary-dark: #006666;
      --primary-light: #00a3a3;
      --primary-bg: #e6f2f2;
      --secondary-color: #ff7e5f;
      --text-color: #2d3748;
      --light-bg: #f0f9f9;
      --white: #ffffff;
      --border-radius: 8px;
      --box-shadow: 0 4px 12px rgba(0, 128, 128, 0.15);
      --transition: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: var(--text-color);
      background: linear-gradient(135deg, var(--light-bg) 0%, #e6f7f7 100%);
      padding: 1rem;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      min-height: 100vh;
    }

    .container {
      width: 100%;
      max-width: 980px;
      background: var(--white);
      border-radius: calc(var(--border-radius) + 0.25rem);
      padding: 1.5rem;
      box-shadow: var(--box-shadow);
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.25rem;
      border: 1px solid rgba(0, 128, 128, 0.1);
    }

    header {
      display: flex;
      gap: 0.75rem;
      align-items: center;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid rgba(0, 128, 128, 0.1);
    }

    .logo {
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 6px 14px rgba(0, 128, 128, 0.2);
    }

    .logo svg {
      filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.08));
    }

    h1 {
      margin: 0;
      font-size: 1.5rem;
      color: var(--primary-color);
      font-weight: 700;
    }

    p.subtitle {
      margin: 0;
      color: var(--text-color);
      opacity: 0.7;
      font-size: 0.9rem;
    }

    /* Controls */
    .controls {
      background: var(--white);
      border-radius: 12px;
      padding: 1.25rem;
      display: grid;
      gap: 0.9rem;
      box-shadow: var(--box-shadow);
      border: 1px solid rgba(0, 128, 128, 0.08);
    }

    .row {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .col {
      flex: 1;
    }

    label {
      font-size: 0.8rem;
      display: block;
      margin-bottom: 0.25rem;
      font-weight: 600;
      color: var(--primary-dark);
    }

    input[type="text"], select {
      width: 100%;
      padding: 0.7rem 0.85rem;
      border-radius: 10px;
      border: 1px solid #e0f0f0;
      font-size: 1rem;
      transition: var(--transition);
      background-color: var(--light-bg);
    }

    input[type="text"]:focus, select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(0, 128, 128, 0.2);
      background-color: var(--white);
    }

    .btn {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      color: var(--white);
      padding: 0.7rem 0.9rem;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      box-shadow: 0 4px 6px rgba(0, 128, 128, 0.2);
    }

    .btn:hover {
      background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
      transform: translateY(-2px);
      box-shadow: 0 6px 8px rgba(0, 128, 128, 0.25);
    }

    .btn.secondary {
      background: transparent;
      color: var(--primary-color);
      border: 1px solid rgba(0, 128, 128, 0.3);
      box-shadow: none;
    }

    .btn.secondary:hover {
      background: rgba(0, 128, 128, 0.1);
      transform: translateY(-1px);
    }

    .btn.ghost {
      background: transparent;
      color: var(--primary-color);
      border: 1px solid rgba(0, 128, 128, 0.2);
      box-shadow: none;
    }

    .btn.ghost:hover {
      background: rgba(0, 128, 128, 0.1);
      transform: translateY(-1px);
    }

    .btn-orange {
      background: linear-gradient(135deg, var(--secondary-color), #ff6b4a);
      color: white;
      box-shadow: 0 4px 6px rgba(255, 126, 95, 0.3);
    }

    .btn-orange:hover {
      background: linear-gradient(135deg, #ff6b4a, var(--secondary-color));
      transform: translateY(-2px);
      box-shadow: 0 6px 8px rgba(255, 126, 95, 0.35);
    }

    .swap-btn {
      width: 44px;
      height: 44px;
      display: inline-grid;
      place-items: center;
      border-radius: 10px;
      border: 1px dashed rgba(0, 128, 128, 0.3);
      background: var(--white);
      transition: var(--transition);
      color: var(--primary-color);
    }

    .swap-btn:hover {
      background: var(--primary-light);
      border-color: var(--primary-color);
      color: white;
      transform: rotate(180deg);
    }

    /* Result card */
    .result {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      color: var(--white);
      border-radius: 12px;
      padding: 1.25rem;
      display: flex;
      gap: 1rem;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 6px 12px rgba(0, 128, 128, 0.25);
    }

    .result .value {
      font-size: 1.7rem;
      font-weight: 700;
    }

    .result .meta {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.9);
    }

    /* History */
    .history {
      background: var(--white);
      border-radius: 12px;
      padding: 1rem;
      box-shadow: var(--box-shadow);
      border: 1px solid rgba(0, 128, 128, 0.08);
    }

    .history-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      max-height: 280px;
      overflow: auto;
      padding-right: 0.25rem;
    }

    .history-item {
      display: flex;
      justify-content: space-between;
      gap: 0.5rem;
      padding: 0.6rem;
      border-radius: 8px;
      background: linear-gradient(90deg, rgba(0, 128, 128, 0.05), rgba(255, 255, 255, 0));
      transition: var(--transition);
      border: 1px solid rgba(0, 128, 128, 0.05);
    }

    .history-item:hover {
      background: linear-gradient(90deg, rgba(0, 128, 128, 0.1), rgba(255, 255, 255, 0));
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0, 128, 128, 0.1);
    }

    .chip {
      display: inline-block;
      background: rgba(0, 128, 128, 0.1);
      padding: 0.3rem 0.6rem;
      border-radius: 999px;
      font-size: 0.8rem;
      cursor: pointer;
      transition: var(--transition);
      border: 1px solid rgba(0, 128, 128, 0.1);
      color: var(--primary-dark);
      font-weight: 500;
    }

    .chip:hover {
      background: rgba(0, 128, 128, 0.2);
      transform: translateY(-1px);
    }

    /* Responsive layout */
    @media (min-width: 820px) {
      .container {
        grid-template-columns: 1fr 380px;
      }

      header {
        grid-column: 1 / -1;
      }

      .controls {
        grid-column: 1 / 2;
      }
    }

    /* small helpers */
    .small {
      font-size: 0.85rem;
    }

    .muted {
      color: var(--text-color);
      opacity: 0.7;
    }

    .flex {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .right {
      margin-left: auto;
    }

    /* Toast */
    .toast {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 1.25rem;
      background: rgba(0, 128, 128, 0.9);
      color: white;
      padding: 0.7rem 1rem;
      border-radius: 8px;
      display: none;
      z-index: 1000;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }

    .toast.show {
      display: block;
    }

    /* Focus visible for keyboard users */
    button:focus, a:focus, input:focus, select:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(0, 128, 128, 0.2);
    }

    /* small animation */
    .animate-pop {
      transition: transform 180ms ease, opacity 180ms ease;
    }

    .popped {
      transform: scale(1.03);
      opacity: 0.98;
    }

    .warning {
      color: #e53e3e;
      font-weight: 600;
    }

    /* SEO content - hidden from users but visible to search engines */
    .seo-content {
      position: absolute;
      left: -10000px;
      top: auto;
      width: 1px;
      height: 1px;
      overflow: hidden;
    }
  </style>
</head>
<body>
  <!-- Hidden SEO content for search engines -->
  <div class="seo-content">
    <h1>Length Converter</h1>
    <p>Free online length converter tool that converts between meters (m), centimeters (cm), millimeters (mm), kilometers (km), inches (in), feet (ft), yards (yd), and miles (mi). Features real-time conversion, adjustable precision, conversion history, and export options.</p>
    <h2>Key Features</h2>
    <ul>
      <li>Convert between meters, centimeters, millimeters, kilometers, inches, feet, yards, and miles</li>
      <li>Real-time conversion as you type</li>
      <li>Adjustable decimal precision from 0 to 8 places</li>
      <li>Conversion history with local storage</li>
      <li>Export results as CSV or JSON</li>
      <li>Copy and share conversion results</li>
      <li>Mobile-responsive design</li>
    </ul>
    <h2>Common Length Conversions</h2>
    <ul>
      <li>1 meter = 100 centimeters</li>
      <li>1 meter = 1000 millimeters</li>
      <li>1 kilometer = 1000 meters</li>
      <li>1 inch = 2.54 centimeters</li>
      <li>1 foot = 12 inches</li>
      <li>1 yard = 3 feet</li>
      <li>1 mile = 5280 feet</li>
      <li>1 mile = 1.609344 kilometers</li>
    </ul>
  </div>

  <main class="container" id="app">
    <header>
      <div class="logo" aria-hidden="true">
        <!-- ruler/measurement svg -->
        <svg width="34" height="34" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="9" width="18" height="6" rx="1" fill="white" />
          <line x1="6" y1="7" x2="6" y2="17" stroke="white" stroke-width="1.5" />
          <line x1="9" y1="7" x2="9" y2="17" stroke="white" stroke-width="1.5" />
          <line x1="12" y1="7" x2="12" y2="17" stroke="white" stroke-width="1.5" />
          <line x1="15" y1="7" x2="15" y2="17" stroke="white" stroke-width="1.5" />
          <line x1="18" y1="7" x2="18" y2="17" stroke="white" stroke-width="1.5" />
        </svg>
      </div>
      <div>
        <h1>Length Converter</h1>
        <p class="subtitle">Convert lengths instantly. History saved locally.</p>
      </div>
    </header>

    <!-- Controls / Left column -->
    <section class="controls" aria-labelledby="controls-heading">
      <h2 id="controls-heading" class="small">Convert length units</h2>

      <div class="row">
        <div class="col">
          <label for="inputValue">Value</label>
          <input id="inputValue" inputmode="decimal" type="text" placeholder="Enter number (e.g. 12.34, -3.5e2)" aria-describedby="valueHelp" />
          <div id="valueHelp" class="small muted">Supports negative & scientific notation. Updates in real time.</div>
        </div>
        <div style="width:44px" class="flex" aria-hidden="true">
          <button class="swap-btn" id="swapBtn" title="Swap units" aria-label="Swap units">↔</button>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label for="fromUnit">From</label>
          <select id="fromUnit" aria-label="From unit"></select>
        </div>
        <div class="col">
          <label for="toUnit">To</label>
          <select id="toUnit" aria-label="To unit"></select>
        </div>
      </div>

      <div class="row">
        <div style="flex:0 0 140px">
          <label for="precision">Precision</label>
          <select id="precision" aria-label="Precision selector">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4" selected>4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
          </select>
        </div>

        <div class="right" style="display:flex; gap:0.5rem; align-items:center">
          <button id="convertBtn" class="btn">Convert</button>
          <button id="resetBtn" class="btn secondary">Reset</button>
        </div>
      </div>

      <div id="resultCard" class="result animate-pop" aria-live="polite">
        <div>
          <div class="value" id="resultValue">—</div>
          <div class="meta" id="resultMeta">Awaiting input</div>
        </div>
        <div style="display:flex; flex-direction:column; gap:0.5rem">
          <button id="copyBtn" class="btn ghost" aria-label="Copy result">Copy</button>
          <button id="shareBtn" class="btn ghost" aria-label="Share result">Share</button>
          <button id="downloadResultBtn" class="btn" title="Download result as CSV/JSON">Download</button>
        </div>
      </div>

      <details id="presets" class="small">
        <summary class="muted">Quick presets</summary>
        <div style="margin-top:0.6rem; display:flex; gap:0.5rem; flex-wrap:wrap">
          <button class="chip" data-value="1" data-from="m" data-to="cm">1 m → cm</button>
          <button class="chip" data-value="1" data-from="ft" data-to="m">1 ft → m</button>
          <button class="chip" data-value="12" data-from="in" data-to="ft">12 in → ft</button>
          <button class="chip" data-value="100" data-from="cm" data-to="m">100 cm → m</button>
          <button class="chip" data-value="1" data-from="mi" data-to="km">1 mi → km</button>
          <button class="chip" data-value="1" data-from="km" data-to="mi">1 km → mi</button>
        </div>
      </details>

    </section>

    <!-- Right column: history + help -->
    <aside class="history" aria-labelledby="history-heading">
      <h3 id="history-heading" class="small">Conversion history</h3>
      <div style="display:flex; gap:0.5rem; align-items:center; margin-bottom:0.5rem">
        <button id="exportAllBtn" class="btn btn-orange small">Export CSV</button>
        <button id="clearHistoryBtn" class="btn secondary small">Clear</button>
        <div class="right small muted">Saved locally (localStorage)</div>
      </div>

      <div class="history-list" id="historyList" role="list" aria-live="polite"></div>
      <div style="margin-top:0.6rem" class="small muted">
        Tip: Use the download button on the result card to save individual compressed rows. Export to back up your history.
      </div>
    </aside>

    <div id="toast" class="toast" role="status" aria-live="polite">Copied!</div>

  </main>

  <script>
  /* ===== Units & conversion factors =====
     We'll convert any input into meters (m) as a base, then convert m into target unit.
  */
  const UNITS = {
    mm: {name:'millimeter', to_m: 0.001, symbol: 'mm'},
    cm: {name:'centimeter', to_m: 0.01, symbol: 'cm'},
    m:  {name:'meter', to_m: 1, symbol: 'm'},
    km: {name:'kilometer', to_m: 1000, symbol: 'km'},
    in: {name:'inch', to_m: 0.0254, symbol: 'in'},
    ft: {name:'foot', to_m: 0.3048, symbol: 'ft'},
    yd: {name:'yard', to_m: 0.9144, symbol: 'yd'},
    mi: {name:'mile', to_m: 1609.344, symbol: 'mi'}
  };

  /* ===== Utility functions ===== */
  function convertToM(value, unitKey){
    const u = UNITS[unitKey];
    if(!u) throw new Error('Unknown unit: ' + unitKey);
    return value * u.to_m;
  }

  function convertFromM(m, unitKey){
    const u = UNITS[unitKey];
    if(!u) throw new Error('Unknown unit: ' + unitKey);
    return m / u.to_m;
  }

  function formatNumber(num, precision, useScientific=false){
    if(!isFinite(num)) return String(num);
    if(useScientific){
      return Number(num).toExponential(precision);
    }
    return Number(num).toLocaleString(undefined, {minimumFractionDigits:0, maximumFractionDigits: precision});
  }

  /* ===== DOM references ===== */
  const inputEl = document.getElementById('inputValue');
  const fromEl = document.getElementById('fromUnit');
  const toEl = document.getElementById('toUnit');
  const precisionEl = document.getElementById('precision');
  const convertBtn = document.getElementById('convertBtn');
  const resetBtn = document.getElementById('resetBtn');
  const swapBtn = document.getElementById('swapBtn');
  const resultValueEl = document.getElementById('resultValue');
  const resultMetaEl = document.getElementById('resultMeta');
  const copyBtn = document.getElementById('copyBtn');
  const shareBtn = document.getElementById('shareBtn');
  const downloadResultBtn = document.getElementById('downloadResultBtn');
  const historyListEl = document.getElementById('historyList');
  const exportAllBtn = document.getElementById('exportAllBtn');
  const clearHistoryBtn = document.getElementById('clearHistoryBtn');
  const toast = document.getElementById('toast');

  // Debounce utility for real-time conversion
  function debounce(fn, wait){ let t; return function(...args){ clearTimeout(t); t = setTimeout(()=>fn.apply(this,args), wait); }; }

  /* ===== Populate unit dropdowns ===== */
  function populateUnits(){
    const keys = Object.keys(UNITS);
    keys.forEach(k=>{
      const opt1 = document.createElement('option'); 
      opt1.value = k; 
      opt1.textContent = `${UNITS[k].symbol} — ${UNITS[k].name}`;
      const opt2 = opt1.cloneNode(true);
      fromEl.appendChild(opt1);
      toEl.appendChild(opt2);
    });
    // sensible defaults
    fromEl.value = 'm';
    toEl.value = 'cm';
  }
  populateUnits();

  /* ===== Input parsing/validation ===== */
  function parseInput(text){
    if(typeof text !== 'string') text = String(text);
    const trimmed = text.trim();
    if(trimmed === '') return null;
    const n = Number(trimmed);
    if(Number.isFinite(n)) return n;
    return NaN; // invalid
  }

  /* ===== History handling (localStorage) ===== */
  const STORAGE_KEY = 'length_converter_history_v1';
  function loadHistory(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return [];
      return JSON.parse(raw);
    }catch(e){ console.warn('Failed to load history', e); return []; }
  }
  function saveHistory(history){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(history.slice(0,1000)));
  }
  function addHistoryRow(row){
    const history = loadHistory();
    history.unshift(row); // newest first
    saveHistory(history.slice(0,100));
    renderHistory();
  }

  function clearHistory(){
    localStorage.removeItem(STORAGE_KEY);
    renderHistory();
  }

  function exportHistoryCSV(){
    const history = loadHistory();
    if(history.length === 0) return alert('No history to export');
    const header = ['timestamp','input','from','result','to','precision'];
    const rows = history.map(h=>header.map(k=>escapeCsv(String(h[k] ?? ''))).join(','));
    const csv = [header.join(','), ...rows].join('\n');
    downloadBlob(csv, 'length-conversion-history.csv', 'text/csv');
  }

  function escapeCsv(value){
    if(value.includes(',') || value.includes('\n') || value.includes('"')){
      return '"' + value.replace(/"/g,'""') + '"';
    }
    return value;
  }

  function renderHistory(){
    const history = loadHistory();
    historyListEl.innerHTML = '';
    if(history.length === 0){
      const empty = document.createElement('div'); 
      empty.className='small muted'; 
      empty.textContent = 'No conversions yet.'; 
      historyListEl.appendChild(empty); 
      return;
    }
    history.slice(0,10).forEach(item=>{
      const it = document.createElement('div'); 
      it.className='history-item'; 
      it.role='listitem';
      const left = document.createElement('div'); 
      left.style.maxWidth='60%';
      left.innerHTML = `<div style="font-weight:600">${item.input} ${item.from} → ${item.result} ${item.to}</div><div class="small muted">${new Date(item.timestamp).toLocaleString()}</div>`;
      const right = document.createElement('div'); 
      right.style.textAlign='right';
      const dl = document.createElement('button'); 
      dl.className='btn secondary small'; 
      dl.textContent='Download';
      dl.onclick = ()=>{ downloadCompressedRow(item); };
      right.appendChild(dl);
      it.appendChild(left); 
      it.appendChild(right);
      historyListEl.appendChild(it);
    });
  }

  /* ===== Downloads ===== */
  function downloadBlob(content, filename, mime){
    const blob = new Blob([content], {type: mime});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); 
    a.href = url; 
    a.download = filename; 
    document.body.appendChild(a); 
    a.click(); 
    a.remove();
    setTimeout(()=>URL.revokeObjectURL(url), 5000);
  }

  function downloadCompressedRow(item){
    const detailedItem = {
      ...item,
      title: `Length Conversion: ${item.input} ${item.from} to ${item.result} ${item.to}`,
      description: `Converted ${item.input} ${UNITS[item.from].name} to ${item.result} ${UNITS[item.to].name} with ${item.precision} decimal precision.`,
      conversionDate: item.timestamp,
      tool: "Length Converter"
    };
    const compressed = JSON.stringify(detailedItem, null, 2);
    downloadBlob(compressed, `length-conversion-${item.timestamp}.json`, 'application/json');
  }

  /* ===== Core conversion logic ===== */
  function performConversion(){
    const raw = inputEl.value;
    const parsed = parseInput(raw);
    const useSci = false; // default
    const precision = Number(precisionEl.value);
    const from = fromEl.value;
    const to = toEl.value;

    if(parsed === null){
      resultValueEl.textContent = '—';
      resultMetaEl.textContent = 'Awaiting input';
      return null;
    }
    if(Number.isNaN(parsed)){
      resultValueEl.textContent = 'Invalid';
      resultMetaEl.textContent = 'Please enter a valid number (examples: 12.34, -3.5e2)';
      return null;
    }

    try{
      const m = convertToM(parsed, from);
      const out = convertFromM(m, to);
      const formatted = formatNumber(out, precision, useSci);
      resultValueEl.textContent = formatted;
      resultMetaEl.textContent = `${UNITS[from].name} → ${UNITS[to].name} • precision ${precision}`;

      const card = document.getElementById('resultCard');
      card.classList.add('popped'); 
      setTimeout(()=>card.classList.remove('popped'), 200);

      const row = { 
        timestamp: new Date().toISOString(), 
        input: String(parsed), 
        from, 
        result: String(out), 
        to, 
        precision 
      };
      addHistoryRow(row);
      return {parsed, out, row};
    }catch(e){
      resultValueEl.textContent = 'Error';
      resultMetaEl.textContent = e.message;
      return null;
    }
  }

  // Debounced auto-convert when user types
  const debouncedConvert = debounce(()=>{ performConversion(); }, 150);

  /* ===== Buttons & interactions ===== */
  inputEl.addEventListener('input', debouncedConvert);
  fromEl.addEventListener('change', debouncedConvert);
  toEl.addEventListener('change', debouncedConvert);
  precisionEl.addEventListener('change', debouncedConvert);
  convertBtn.addEventListener('click', performConversion);
  resetBtn.addEventListener('click', ()=>{
    inputEl.value = '';
    fromEl.value = 'm';
    toEl.value = 'cm';
    precisionEl.value = '4';
    performConversion();
  });

  swapBtn.addEventListener('click', ()=>{
    const a = fromEl.value; 
    fromEl.value = toEl.value; 
    toEl.value = a;
    performConversion();
  });

  copyBtn.addEventListener('click', async ()=>{
    const text = resultValueEl.textContent + ' ' + toEl.value;
    try{
      await navigator.clipboard.writeText(text);
      showToast('Copied to clipboard');
    }catch(e){
      const ta = document.createElement('textarea'); 
      ta.value = text; 
      document.body.appendChild(ta); 
      ta.select();
      try{ 
        document.execCommand('copy'); 
        showToast('Copied to clipboard'); 
      }catch(_){ 
        alert('Copy failed.'); 
      }
      ta.remove();
    }
  });

  shareBtn.addEventListener('click', async ()=>{
    const text = `${inputEl.value} ${fromEl.value} → ${resultValueEl.textContent} ${toEl.value}`;
    if(navigator.share){
      try{ 
        await navigator.share({
          title:'Length conversion', 
          text,
          url: window.location.href
        }); 
      }catch(e){ }
    }else{
      try{ 
        await navigator.clipboard.writeText(text); 
        showToast('Result copied (share fallback)'); 
      }catch(e){ 
        alert(text); 
      }
    }
  });

  downloadResultBtn.addEventListener('click', ()=>{
    const parsed = parseInput(inputEl.value);
    if(parsed === null || Number.isNaN(parsed)) return alert('Enter a valid number first');
    const precision = Number(precisionEl.value);
    const from = fromEl.value; 
    const to = toEl.value;
    const m = convertToM(parsed, from); 
    const out = convertFromM(m, to);
    const row = { 
      timestamp: new Date().toISOString(), 
      input: String(parsed), 
      from, 
      result: String(out), 
      to, 
      precision 
    };
    downloadCompressedRow(row);
  });

  exportAllBtn.addEventListener('click', exportHistoryCSV);
  clearHistoryBtn.addEventListener('click', ()=>{ 
    if(confirm('Clear history?')) clearHistory(); 
  });

  /* ===== Preset chips ===== */
  document.querySelectorAll('#presets .chip').forEach(ch=>{
    ch.addEventListener('click', ()=>{
      inputEl.value = ch.dataset.value;
      fromEl.value = ch.dataset.from;
      toEl.value = ch.dataset.to;
      performConversion();
    });
  });

  /* ===== Small toast helper ===== */
  let toastTimer = null;
  function showToast(msg, ms=1800){
    toast.textContent = msg; 
    toast.classList.add('show');
    clearTimeout(toastTimer); 
    toastTimer = setTimeout(()=>{ 
      toast.classList.remove('show'); 
    }, ms);
  }

  /* ===== Initial render ===== */
  renderHistory();
  (function tryRecoverFromParams(){
    try{
      const params = new URLSearchParams(location.search);
      if(params.has('v')){ inputEl.value = params.get('v'); }
      if(params.has('from')) fromEl.value = params.get('from');
      if(params.has('to')) toEl.value = params.get('to');
      if(params.has('prec')) precisionEl.value = params.get('prec');
    }catch(e){}
    performConversion();
  })();

  /* ===== Notes on numeric limits =====
     - This tool uses JavaScript Number (IEEE 754 double). Very large/small values may lose precision.
     - For typical human-scale conversions this is fine. For very high precision or extreme magnitudes, consider a big-number library.
  */

  /* ===== Example unit tests (comments) =====
     console.assert(Math.abs(convertFromM(convertToM(1,'m'),'cm') - 100) < 1e-9, '1 m -> 100 cm');
     console.assert(Math.abs(convertFromM(convertToM(1,'ft'),'m') - 0.3048) < 1e-12, '1 ft -> 0.3048 m');
     console.assert(Math.abs(convertFromM(convertToM(12,'in'),'ft') - 1) < 1e-12, '12 in -> 1 ft');
  */

  </script>
</body>
          </html>
