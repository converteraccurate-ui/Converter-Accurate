<!doctype html>
<!--
  Length Converter - Single-file HTML/CSS/JS
  Theme: Olive green & white
  Features: real-time conversion, copy/share, download history as CSV, localStorage history, mobile-responsive
  Author: Generated by ChatGPT

  Notes / quick tests (in-code comments below):
    - 1 in -> 2.54 cm
    - 1000 mm -> 1 m
    - 1 mi -> 1.609344 km

  Change colors via CSS variables in :root
-->
<html lang="en">
<head>
  <link rel="icon" href="favicon-16x16.png" type="image/x-icon">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Length Converter</title>
  <style>
    :root{
      --olive-500: #6b8e23; /* olive green */
      --olive-600: #5f7e1d;
      --olive-50: #f5f8f2;
      --bg: #ffffff;
      --muted: #666666;
      --radius-xl: 1rem; /* 2xl style */
      --shadow: 0 6px 18px rgba(0,0,0,0.06);
      --gap: 1rem;
      --max-width: 980px;
      --focus: 3px solid rgba(107,142,35,0.18);
    }

    /* Basic reset */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family: system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;
      margin:0; background:var(--bg); color:#0b0b0b; -webkit-font-smoothing:antialiased;
      padding:1rem; display:flex; align-items:flex-start; justify-content:center;
    }

    .container{
      width:100%; max-width:var(--max-width);
      background:linear-gradient(180deg,var(--bg) 0%,var(--olive-50) 100%);
      border-radius:calc(var(--radius-xl) + 0.25rem); padding:1.25rem; box-shadow:var(--shadow);
      display:grid; grid-template-columns: 1fr; gap:1rem;
    }

    header{display:flex; gap:0.75rem; align-items:center}
    .logo{
      width:56px; height:56px; background:var(--olive-500); border-radius:12px; display:flex; align-items:center; justify-content:center;
      box-shadow:0 6px 14px rgba(107,142,35,0.12);
    }
    .logo svg{filter:drop-shadow(0 2px 6px rgba(0,0,0,0.08));}
    h1{margin:0; font-size:1.1rem}
    p.subtitle{margin:0; color:var(--muted); font-size:0.9rem}

    /* Controls */
    .controls{background:white; border-radius:12px; padding:1rem; display:grid; gap:0.75rem; box-shadow:var(--shadow)}
    .row{display:flex; gap:0.5rem; align-items:center}
    .col{flex:1}
    label{font-size:0.8rem; display:block; margin-bottom:0.25rem}

    input[type="text"], select{width:100%; padding:0.6rem 0.75rem; border-radius:10px; border:1px solid #e6e6e6; font-size:1rem}
    input[type="text"]:focus, select:focus{outline:none; box-shadow:var(--focus)}

    .btn{background:var(--olive-500); color:white; padding:0.6rem 0.8rem; border:none; border-radius:10px; cursor:pointer; font-weight:600}
    .btn.secondary{background:transparent; color:var(--olive-600); border:1px solid rgba(95,126,29,0.12)}
    .btn.ghost{background:transparent; color:var(--olive-600); border:none}
    .btn:active{transform:translateY(1px)}

    .swap-btn{width:44px; height:44px; display:inline-grid; place-items:center; border-radius:10px; border:1px dashed rgba(0,0,0,0.06)}

    /* Result card */
    .result{background:var(--olive-500); color:white; border-radius:12px; padding:1rem; display:flex; gap:1rem; align-items:center; justify-content:space-between}
    .result .value{font-size:1.6rem; font-weight:700}
    .result .meta{font-size:0.9rem; color:rgba(255,255,255,0.9)}

    /* History */
    .history{background:white; border-radius:12px; padding:0.75rem; box-shadow:var(--shadow)}
    .history-list{display:flex; flex-direction:column; gap:0.5rem; max-height:280px; overflow:auto; padding-right:0.25rem}
    .history-item{display:flex; justify-content:space-between; gap:0.5rem; padding:0.5rem; border-radius:8px; background:linear-gradient(90deg, rgba(107,142,35,0.03), rgba(255,255,255,0));}
    .chip{display:inline-block; background:rgba(95,126,29,0.1); padding:0.25rem 0.5rem; border-radius:999px; font-size:0.8rem}

    /* Responsive layout */
    @media (min-width:820px){
      .container{grid-template-columns: 1fr 380px}
      header{grid-column:1/-1}
      .controls{grid-column:1/2}
    }

    /* small helpers */
    .small{font-size:0.85rem}
    .muted{color:var(--muted)}
    .flex{display:flex; gap:0.5rem; align-items:center}
    .right{margin-left:auto}

    /* Toast */
    .toast{position:fixed; left:50%; transform:translateX(-50%); bottom:1.25rem; background:rgba(0,0,0,0.8); color:white; padding:0.6rem 0.9rem; border-radius:8px; display:none}
    .toast.show{display:block}

    /* Focus visible for keyboard users */
    button:focus, a:focus, input:focus, select:focus{outline:none; box-shadow:var(--focus)}

    /* small animation */
    .animate-pop{transition:transform 180ms ease, opacity 180ms ease}
    .popped{transform:scale(1.03); opacity:0.98}

  </style>
</head>
<body>
  <main class="container" id="app">
    <header>
      <div class="logo" aria-hidden="true">
        <!-- simple ruler / measure svg -->
        <svg width="34" height="34" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="6" width="18" height="12" rx="3" fill="white" />
          <path d="M6 9v6M9 9v6M12 9v6M15 9v6M18 9v6" stroke="var(--olive-500)" stroke-width="0.9" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </div>
      <div>
        <h1>Length Converter</h1>
        <p class="subtitle">Convert lengths instantly — olive green & white theme. History saved locally.</p>
      </div>
    </header>

    <!-- Controls / Left column -->
    <section class="controls" aria-labelledby="controls-heading">
      <h2 id="controls-heading" class="small">Convert length units</h2>

      <div class="row">
        <div class="col">
          <label for="inputValue">Value</label>
          <input id="inputValue" inputmode="decimal" type="text" placeholder="Enter number (e.g. 12.34, -3.5e2)" aria-describedby="valueHelp" />
          <div id="valueHelp" class="small muted">Supports negative & scientific notation. Updates in real time.</div>
        </div>
        <div style="width:44px" class="flex" aria-hidden="true">
          <button class="swap-btn" id="swapBtn" title="Swap units" aria-label="Swap units">↔</button>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label for="fromUnit">From</label>
          <select id="fromUnit" aria-label="From unit"></select>
        </div>
        <div class="col">
          <label for="toUnit">To</label>
          <select id="toUnit" aria-label="To unit"></select>
        </div>
      </div>

      <div class="row">
        <div style="flex:0 0 140px">
          <label for="precision">Precision</label>
          <select id="precision" aria-label="Precision selector">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4" selected>4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
          </select>
        </div>

        <div class="right" style="display:flex; gap:0.5rem; align-items:center">
          <button id="convertBtn" class="btn">Convert</button>
          <button id="resetBtn" class="btn secondary">Reset</button>
        </div>
      </div>

      <div id="resultCard" class="result animate-pop" aria-live="polite">
        <div>
          <div class="value" id="resultValue">—</div>
          <div class="meta" id="resultMeta">Awaiting input</div>
        </div>
        <div style="display:flex; flex-direction:column; gap:0.5rem">
          <button id="copyBtn" class="btn ghost" aria-label="Copy result">Copy</button>
          <button id="shareBtn" class="btn ghost" aria-label="Share result">Share</button>
          <button id="downloadResultBtn" class="btn" title="Download result as CSV/JSON">Download</button>
        </div>
      </div>

      <details id="presets" class="small">
        <summary class="muted">Quick presets</summary>
        <div style="margin-top:0.6rem; display:flex; gap:0.5rem; flex-wrap:wrap">
          <button class="chip" data-value="1" data-from="in" data-to="cm">1 in → cm</button>
          <button class="chip" data-value="1" data-from="mi" data-to="km">1 mi → km</button>
          <button class="chip" data-value="1" data-from="ft" data-to="m">1 ft → m</button>
          <button class="chip" data-value="1000" data-from="mm" data-to="m">1000 mm → m</button>
        </div>
      </details>

    </section>

    <!-- Right column: history + help -->
    <aside class="history" aria-labelledby="history-heading">
      <h3 id="history-heading" class="small">Conversion history</h3>
      <div style="display:flex; gap:0.5rem; align-items:center; margin-bottom:0.5rem">
        <button id="exportAllBtn" class="btn small">Export CSV</button>
        <button id="clearHistoryBtn" class="btn secondary small">Clear</button>
        <div class="right small muted">Saved locally (localStorage)</div>
      </div>

      <div class="history-list" id="historyList" role="list" aria-live="polite"></div>
      <div style="margin-top:0.6rem" class="small muted">
        Tip: Use the download button on the result card to save individual compressed rows. Export to back up your history.
      </div>
    </aside>

    <div id="toast" class="toast" role="status" aria-live="polite">Copied!</div>

  </main>

  <script>
  /* ===== Units & conversion factors =====
     We'll convert any input into meters as a base, then convert meters into target unit.
  */
  const UNITS = {
    mm: {name:'millimetre', to_m: 0.001, aliases:['mm','millimetre','millimeter']},
    cm: {name:'centimetre', to_m: 0.01, aliases:['cm','centimetre','centimeter']},
    m:  {name:'metre', to_m: 1, aliases:['m','metre','meter']},
    km: {name:'kilometre', to_m: 1000, aliases:['km','kilometre','kilometer']},
    in: {name:'inch', to_m: 0.0254, aliases:['in','inch','"']},
    ft: {name:'foot', to_m: 0.3048, aliases:['ft','foot','feet']},
    yd: {name:'yard', to_m: 0.9144, aliases:['yd','yard']},
    mi: {name:'mile', to_m: 1609.344, aliases:['mi','mile']}
  };

  // Build alias -> canonical mapping
  const ALIAS_MAP = {};
  Object.keys(UNITS).forEach(k=>{
    UNITS[k].aliases.forEach(a=>ALIAS_MAP[a.toLowerCase()] = k);
  });

  /* ===== Utility functions ===== */
  function convertToMeters(value, unitKey){
    // value: Number, unitKey: canonical unit (mm,cm,m,...) -> returns meters
    const u = UNITS[unitKey];
    if(!u) throw new Error('Unknown unit: ' + unitKey);
    return value * u.to_m;
  }

  function convertFromMeters(meters, unitKey){
    const u = UNITS[unitKey];
    if(!u) throw new Error('Unknown unit: ' + unitKey);
    return meters / u.to_m;
  }

  function formatNumber(num, precision, useScientific=false){
    if(!isFinite(num)) return String(num);
    // optionally use scientific notation for very large or small numbers
    if(useScientific){
      return Number(num).toExponential(precision);
    }
    return Number(num).toLocaleString(undefined, {minimumFractionDigits:0, maximumFractionDigits: precision});
  }

  /* ===== DOM references ===== */
  const inputEl = document.getElementById('inputValue');
  const fromEl = document.getElementById('fromUnit');
  const toEl = document.getElementById('toUnit');
  const precisionEl = document.getElementById('precision');
  const convertBtn = document.getElementById('convertBtn');
  const resetBtn = document.getElementById('resetBtn');
  const swapBtn = document.getElementById('swapBtn');
  const resultValueEl = document.getElementById('resultValue');
  const resultMetaEl = document.getElementById('resultMeta');
  const copyBtn = document.getElementById('copyBtn');
  const shareBtn = document.getElementById('shareBtn');
  const downloadResultBtn = document.getElementById('downloadResultBtn');
  const historyListEl = document.getElementById('historyList');
  const exportAllBtn = document.getElementById('exportAllBtn');
  const clearHistoryBtn = document.getElementById('clearHistoryBtn');
  const toast = document.getElementById('toast');

  // Debounce utility for real-time conversion
  function debounce(fn, wait){ let t; return function(...args){ clearTimeout(t); t = setTimeout(()=>fn.apply(this,args), wait); }; }

  /* ===== Populate unit dropdowns ===== */
  function populateUnits(){
    const keys = Object.keys(UNITS);
    keys.forEach(k=>{
      const opt1 = document.createElement('option'); opt1.value = k; opt1.textContent = `${k} — ${UNITS[k].name}`;
      const opt2 = opt1.cloneNode(true);
      fromEl.appendChild(opt1);
      toEl.appendChild(opt2);
    });
    // sensible defaults
    fromEl.value = 'm';
    toEl.value = 'cm';
  }
  populateUnits();

  /* ===== Input parsing/validation ===== */
  function parseInput(text){
    if(typeof text !== 'string') text = String(text);
    const trimmed = text.trim();
    if(trimmed === '') return null;
    // Accept scientific notation via Number()
    const n = Number(trimmed);
    if(Number.isFinite(n)) return n;
    return NaN; // invalid
  }

  /* ===== History handling (localStorage) ===== */
  const STORAGE_KEY = 'length_converter_history_v1';
  function loadHistory(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return [];
      return JSON.parse(raw);
    }catch(e){ console.warn('Failed to load history', e); return []; }
  }
  function saveHistory(history){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(history.slice(0,1000)));
  }
  function addHistoryRow(row){
    const history = loadHistory();
    history.unshift(row); // newest first
    // keep only last 100 entries
    saveHistory(history.slice(0,100));
    renderHistory();
  }

  function clearHistory(){
    localStorage.removeItem(STORAGE_KEY);
    renderHistory();
  }

  function exportHistoryCSV(){
    const history = loadHistory();
    if(history.length === 0) return alert('No history to export');
    const header = ['timestamp','input','from','result','to','precision'];
    const rows = history.map(h=>header.map(k=>escapeCsv(String(h[k] ?? ''))).join(','));
    const csv = [header.join(','), ...rows].join('\n');
    downloadBlob(csv, 'conversion-history.csv', 'text/csv');
  }

  function escapeCsv(value){
    if(value.includes(',') || value.includes('\n') || value.includes('"')){
      return '"' + value.replace(/"/g,'""') + '"';
    }
    return value;
  }

  function renderHistory(){
    const history = loadHistory();
    historyListEl.innerHTML = '';
    if(history.length === 0){
      const empty = document.createElement('div'); empty.className='small muted'; empty.textContent = 'No conversions yet.'; historyListEl.appendChild(empty); return;
    }
    history.slice(0,10).forEach(item=>{
      const it = document.createElement('div'); it.className='history-item'; it.role='listitem';
      const left = document.createElement('div'); left.style.maxWidth='60%';
      left.innerHTML = `<div style="font-weight:600">${item.input} ${item.from} → ${item.result} ${item.to}</div><div class="small muted">${new Date(item.timestamp).toLocaleString()}</div>`;
      const right = document.createElement('div'); right.style.textAlign='right';
      const dl = document.createElement('button'); dl.className='btn secondary small'; dl.textContent='Download';
      dl.onclick = ()=>{ downloadCompressedRow(item); };
      right.appendChild(dl);
      it.appendChild(left); it.appendChild(right);
      historyListEl.appendChild(it);
    });
  }

  /* ===== Downloads ===== */
  function downloadBlob(content, filename, mime){
    const blob = new Blob([content], {type: mime});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove();
    setTimeout(()=>URL.revokeObjectURL(url), 5000);
  }

  function downloadCompressedRow(item){
    // small JSON row
    const compressed = JSON.stringify(item);
    downloadBlob(compressed, `conversion-${item.timestamp}.json`, 'application/json');
  }

  /* ===== Core conversion logic ===== */
  function performConversion(){
    const raw = inputEl.value;
    const parsed = parseInput(raw);
    const useSci = false; // default
    const precision = Number(precisionEl.value);
    const from = fromEl.value;
    const to = toEl.value;

    if(parsed === null){
      // empty
      resultValueEl.textContent = '—';
      resultMetaEl.textContent = 'Awaiting input';
      return null;
    }
    if(Number.isNaN(parsed)){
      resultValueEl.textContent = 'Invalid';
      resultMetaEl.textContent = 'Please enter a valid number (examples: 12.34, -3.5e2)';
      return null;
    }

    try{
      const meters = convertToMeters(parsed, from);
      const out = convertFromMeters(meters, to);
      const formatted = formatNumber(out, precision, useSci);
      resultValueEl.textContent = formatted;
      resultMetaEl.textContent = `${from} → ${to} • precision ${precision}`;

      // tiny pop animation
      const card = document.getElementById('resultCard');
      card.classList.add('popped'); setTimeout(()=>card.classList.remove('popped'), 200);

      // Save a history row
      const row = { timestamp: new Date().toISOString(), input: String(parsed), from, result: String(out), to, precision };
      addHistoryRow(row);
      return {parsed, out, row};
    }catch(e){
      resultValueEl.textContent = 'Error';
      resultMetaEl.textContent = e.message;
      return null;
    }
  }

  // Debounced auto-convert when user types
  const debouncedConvert = debounce(()=>{ performConversion(); }, 150);

  /* ===== Buttons & interactions ===== */
  inputEl.addEventListener('input', debouncedConvert);
  fromEl.addEventListener('change', debouncedConvert);
  toEl.addEventListener('change', debouncedConvert);
  precisionEl.addEventListener('change', debouncedConvert);
  convertBtn.addEventListener('click', performConversion);
  resetBtn.addEventListener('click', ()=>{
    inputEl.value = '';
    fromEl.value = 'm';
    toEl.value = 'cm';
    precisionEl.value = '4';
    performConversion();
  });

  swapBtn.addEventListener('click', ()=>{
    const a = fromEl.value; fromEl.value = toEl.value; toEl.value = a;
    performConversion();
  });

  copyBtn.addEventListener('click', async ()=>{
    const text = resultValueEl.textContent + ' ' + toEl.value;
    try{
      await navigator.clipboard.writeText(text);
      showToast('Copied to clipboard');
    }catch(e){
      // fallback
      const ta = document.createElement('textarea'); ta.value = text; document.body.appendChild(ta); ta.select();
      try{ document.execCommand('copy'); showToast('Copied to clipboard'); }catch(_){ alert('Copy failed.'); }
      ta.remove();
    }
  });

  shareBtn.addEventListener('click', async ()=>{
    const text = `${inputEl.value} ${fromEl.value} → ${resultValueEl.textContent} ${toEl.value}`;
    if(navigator.share){
      try{ await navigator.share({title:'Length conversion', text}); }catch(e){ /* user cancelled */ }
    }else{
      try{ await navigator.clipboard.writeText(text); showToast('Result copied (share fallback)'); }catch(e){ alert(text); }
    }
  });

  downloadResultBtn.addEventListener('click', ()=>{
    const parsed = parseInput(inputEl.value);
    if(parsed === null || Number.isNaN(parsed)) return alert('Enter a valid number first');
    const precision = Number(precisionEl.value);
    const from = fromEl.value; const to = toEl.value;
    const meters = convertToMeters(parsed, from); const out = convertFromMeters(meters, to);
    const row = { timestamp: new Date().toISOString(), input: String(parsed), from, result: String(out), to, precision };
    // download compressed JSON row
    downloadCompressedRow(row);
  });

  exportAllBtn.addEventListener('click', exportHistoryCSV);
  clearHistoryBtn.addEventListener('click', ()=>{ if(confirm('Clear history?')) clearHistory(); });

  /* ===== Preset chips ===== */
  document.querySelectorAll('#presets .chip').forEach(ch=>{
    ch.addEventListener('click', ()=>{
      inputEl.value = ch.dataset.value;
      fromEl.value = ch.dataset.from;
      toEl.value = ch.dataset.to;
      performConversion();
    });
  });

  /* ===== Small toast helper ===== */
  let toastTimer = null;
  function showToast(msg, ms=1800){
    toast.textContent = msg; toast.classList.add('show');
    clearTimeout(toastTimer); toastTimer = setTimeout(()=>{ toast.classList.remove('show'); }, ms);
  }

  /* ===== Download helper used by history =====*/
  // already defined above: downloadCompressedRow

  /* ===== Initial render ===== */
  renderHistory();

  // initial convert if there is an input in persistent state (optional)
  (function tryRecoverFromParams(){
    // Optionally read URL params: ?v=1&from=m&to=cm&prec=4
    try{
      const params = new URLSearchParams(location.search);
      if(params.has('v')){ inputEl.value = params.get('v'); }
      if(params.has('from')) fromEl.value = params.get('from');
      if(params.has('to')) toEl.value = params.get('to');
      if(params.has('prec')) precisionEl.value = params.get('prec');
    }catch(e){}
    performConversion();
  })();

  /* ===== Notes on numeric limits =====
     - This tool uses JavaScript Number (IEEE 754 double). Very large/small values may lose precision.
     - For typical human-scale conversions this is fine. For very high precision or extreme magnitudes, consider a big-number library.
  */

  /* ===== Example unit tests (comments) =====
     These are example checks you can run in browser console:
     console.assert(Math.abs(convertFromMeters(convertToMeters(1,'in'),'cm') - 2.54) < 1e-12, '1 in -> 2.54 cm');
     console.assert(Math.abs(convertFromMeters(convertToMeters(1000,'mm'),'m') - 1) < 1e-12, '1000 mm -> 1 m');
     console.assert(Math.abs(convertFromMeters(convertToMeters(1,'mi'),'km') - 1.609344) < 1e-12, '1 mi -> 1.609344 km');
  */

  </script>
  <script type="text/javascript">
	atOptions = {
		'key' : 'eb123b51d7c13873ae0d32a5582d5667',
		'format' : 'iframe',
		'height' : 60,
		'width' : 468,
		'params' : {}
	};
  </scrpt>
</body>
</html>
